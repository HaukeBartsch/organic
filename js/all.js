import { organic } from './organic.js';

function main() {

    // an open path
    let centerline = (new organic())
        .points(52)
        .grid(52, 1)
        .selectLast(Math.floor(52/3))
        .bendUp(200)
        //.selectLast(60)
        //.bendUp(-300);
    // a closed path
    let corridor = centerline.copy()
        .selectAll()
        .corridor(25);

    centerline.draw('draw');
    corridor.draw('draw');

    // distribute 10 points equidistantly along the centerline
    let centers = centerline.copy().selectAll()
        .spline(10 * 2)
        .remove(function (p, i) {
            return i % 2 == 0;
        });
    centers.drawDots('draw');

    let voronois = centers.copy().selectAll()
        .voronoi(corridor);

    var line = d3.line()
            .curve(/*d3.curveCardinalClosed*/ /*d3.curveCatmullRomClosed*/ d3.curveBasisClosed );
    for (let v of voronois) {
        let v2 = v.copy().selectAll().increaseResolution(3);//.spline(11);
        let numPointsBefore = 0;
        do {
            numPointsBefore = v2._points.length;
            v2.selectAll().simplify(10).selectAll();
        } while (v2._points.length < numPointsBefore);
        //v2.rotateIndex(2).selectAll();
        // points 0 and last point are identical, remove duplicate point
        v2._points.pop();

        const svg = document.getElementById('draw'); // Assuming you have an SVG element
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        
        path.setAttribute("d", line(v2._points.map(function(a) { return [a.x, a.y]; })));
        path.setAttribute('fill', v._color);
        path.setAttribute('stroke', v._color);
        path.setAttribute('stroke-width', 2);
        path.setAttribute('fill-opacity', 0.5);
        svg.appendChild(path);

        //v.copy().selectFirst(2).drawDots('draw', 5);
        //v2.selectAll().drawDots('draw', 3);
        //v2.selectAll().drawIds('draw', 9);
    }
}
main();


// M100,194.83333333333348C100,190.33333333333348,100,182.66666666666683,100.00000000000006,178.83333333333348C100.00000000000011,175.00000000000014,100.00000000000024,175.0000000000001,100.0000000000003,175.00000000000009C100.00000000000038,175.00000000000009,100.00000000000038,175.00000000000009,100.00000000000044,175.00000000000009C100.0000000000005,175.00000000000009,100.00000000000063,175.00000000000003,103.83333333333404,175C107.66666666666742,175,115.3333333333341,175,126.12892532348695,175C136.92451731363983,175,150.84903462727888,175,161.64462661743175,175C172.4402186075846,175,180.10688527425125,175,183.9402186075846,178.83333333333334C187.77355194091794,182.66666666666666,187.77355194091794,190.33333333333334,187.77355194091794,194.83333333333334C187.77355194091794,199.33333333333334,187.77355194091794,200.66666666666666,187.77355194091794,205.16666666666666C187.77355194091794,209.66666666666666,187.77355194091794,217.33333333333334,183.9402186075846,221.16666666666666C180.10688527425125,225,172.4402186075846,225,161.6446266174316,225C150.84903462727863,225,136.9245173136393,225,126.12892532348633,225C115.33333333333333,225,107.66666666666667,225,103.83333333333333,221.16666666666666C100,217.33333333333334,100,209.66666666666666,100,205.1666666666667C100,200.66666666666674,100,199.33333333333346,100,194.83333333333348
// M187.77355194091794,194.83333333333334C187.77355194091794,190.33333333333334,187.77355194091794,182.66666666666666,191.60688527425125,178.83333333333334C195.4402186075846,175,203.10688527425125,175,213.90247853597,175C224.69807179768875,175,238.6225916544596,175,249.41818491617835,175C260.21377817789704,175,267.8804448445637,175,271.7137781778971,178.83333333333334C275.5471115112304,182.66666666666666,275.5471115112304,190.33333333333334,275.5471115112304,194.83333333333334C275.5471115112304,199.3333333333333,275.5471115112304,200.6666666666666,275.5471115112304,205.1666666666666C275.5471115112304,209.66666666666654,275.5471115112304,217.33333333333323,271.7137781778971,221.1666666666666C267.8804448445637,224.9999999999999,260.21377817789704,224.99999999999991,253.64447844791087,224.99999999999991C247.07517871792467,224.99999999999991,241.6032459246189,224.99999999999997,235.03394619463268,224.99999999999997C228.46464646464645,225,220.7979797979798,225,214.8514996987802,225C208.90501959958058,225,204.67872606784806,225,202.56557930198178,225C200.45243253611554,225,200.45243253611554,225,198.33928577024926,225C196.226139004383,225,191.99984547265046,225,189.8866987067842,221.16666666666666C187.77355194091794,217.33333333333334,187.77355194091794,209.66666666666666,187.77355194091794,205.16666666666666C187.77355194091794,200.66666666666666,187.77355194091794,199.33333333333334,187.77355194091794,194.83333333333334